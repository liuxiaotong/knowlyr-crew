#!/usr/bin/env bash
#
# pre-commit hook: 拦截 private/ 下的文件进入公开仓库
# 防止 git add -f 穿透 .gitignore
#

BLOCKED_FILES=$(git diff --cached --name-only | grep -E '(^|/)private/')

if [ -n "$BLOCKED_FILES" ]; then
    echo ""
    echo "==============================================="
    echo "  COMMIT BLOCKED: private/ 文件不得提交"
    echo "==============================================="
    echo ""
    echo "以下文件被拦截:"
    echo ""
    echo "$BLOCKED_FILES" | while read -r f; do
        echo "  - $f"
    done
    echo ""
    echo "请先 unstage 这些文件:"
    echo "  git reset HEAD <file>"
    echo ""
    exit 1
fi
